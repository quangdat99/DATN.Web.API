--
-- Script was generated by Devart dbForge Studio 2020 for MySQL, Version 9.0.338.0
-- Product home page: http://www.devart.com/dbforge/mysql/studio
-- Script date 11/23/2022 11:20:29 PM
-- Server version: 8.0.31
-- Client version: 4.1
--

-- 
-- Disable foreign keys
-- 
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;

-- 
-- Set SQL mode
-- 
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;

-- 
-- Set character set the client will use to send SQL statements to the server
--
SET NAMES 'utf8';

--
-- Set default database
--
USE develop;

--
-- Drop table `attribute`
--
DROP TABLE IF EXISTS attribute;

--
-- Drop table `category`
--
DROP TABLE IF EXISTS category;

--
-- Drop table `color`
--
DROP TABLE IF EXISTS color;

--
-- Drop table `comment`
--
DROP TABLE IF EXISTS comment;

--
-- Drop table `product_cart`
--
DROP TABLE IF EXISTS product_cart;

--
-- Drop table `setting`
--
DROP TABLE IF EXISTS setting;

--
-- Drop table `size`
--
DROP TABLE IF EXISTS size;

--
-- Drop table `voucher`
--
DROP TABLE IF EXISTS voucher;

--
-- Drop table `voucher_user`
--
DROP TABLE IF EXISTS voucher_user;

--
-- Drop procedure `Proc_GenEntity`
--
DROP PROCEDURE IF EXISTS Proc_GenEntity;

--
-- Drop function `SnakeToPascal`
--
DROP FUNCTION IF EXISTS SnakeToPascal;

--
-- Drop procedure `Proc_GetProductHome`
--
DROP PROCEDURE IF EXISTS Proc_GetProductHome;

--
-- Drop procedure `Proc_ProductInfo`
--
DROP PROCEDURE IF EXISTS Proc_ProductInfo;

--
-- Drop table `product_detail`
--
DROP TABLE IF EXISTS product_detail;

--
-- Drop table `product`
--
DROP TABLE IF EXISTS product;

--
-- Drop table `product_order`
--
DROP TABLE IF EXISTS product_order;

--
-- Drop table `order`
--
DROP TABLE IF EXISTS `order`;

--
-- Drop procedure `Proc_ConvertStringToTable`
--
DROP PROCEDURE IF EXISTS Proc_ConvertStringToTable;

--
-- Drop table `product_category`
--
DROP TABLE IF EXISTS product_category;

--
-- Drop procedure `Proc_GetUserInfo`
--
DROP PROCEDURE IF EXISTS Proc_GetUserInfo;

--
-- Drop table `address`
--
DROP TABLE IF EXISTS address;

--
-- Drop table `user`
--
DROP TABLE IF EXISTS user;

--
-- Set default database
--
USE develop;

--
-- Create table `user`
--
CREATE TABLE user (
  user_id char(36) NOT NULL,
  first_name varchar(100) NOT NULL COMMENT 'Họ người dùng',
  last_name varchar(100) NOT NULL COMMENT 'Tên người dùng',
  email varchar(50) NOT NULL COMMENT 'Địa chỉ email của người dùng',
  password varchar(255) NOT NULL COMMENT 'Mật khẩu đăng nhập',
  phone varchar(20) NOT NULL COMMENT 'Số điện thoại người dùng',
  avatar varchar(255) DEFAULT NULL COMMENT 'Đường dẫn ảnh đại diện',
  role int NOT NULL COMMENT 'Quyển người dùng (Người mua hàng, Quản trị hệ thống)',
  is_block tinyint NOT NULL COMMENT 'Có bị chặn hoạt động hay không',
  cart_id char(36) NOT NULL COMMENT 'Định danh giỏ hàng',
  PRIMARY KEY (user_id)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 3276,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_unicode_ci,
COMMENT = 'Bảng thông tin người dùng';

--
-- Create table `address`
--
CREATE TABLE address (
  address_id char(36) NOT NULL COMMENT 'Định danh địa chỉ',
  user_id char(36) NOT NULL COMMENT 'Định danh của người dùng',
  province varchar(255) NOT NULL COMMENT 'Tỉnh/ thành phố',
  province_code int DEFAULT NULL COMMENT 'Mã tỉnh / thành phố',
  district varchar(255) NOT NULL COMMENT 'quận/ huyện',
  district_code int DEFAULT NULL COMMENT 'Mã quận huyện',
  commune varchar(255) NOT NULL COMMENT 'xã/ phường',
  commune_code int DEFAULT NULL COMMENT 'Mã xã phường',
  address_detail varchar(255) NOT NULL COMMENT 'Địa chỉ chi tiết',
  is_default tinyint NOT NULL COMMENT 'Có là địa chỉ mặc định không',
  PRIMARY KEY (address_id)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 2048,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_unicode_ci,
COMMENT = 'Bảng thông tin địa chỉ của người dùng';

--
-- Create foreign key
--
ALTER TABLE address
ADD CONSTRAINT FK_user FOREIGN KEY (user_id)
REFERENCES user (user_id) ON DELETE CASCADE;

DELIMITER $$

--
-- Create procedure `Proc_GetUserInfo`
--
CREATE PROCEDURE Proc_GetUserInfo (IN $UserId char(36))
SQL SECURITY INVOKER
COMMENT 'Lấy thông tin người dùng'
BEGIN
  SELECT
    u.user_id,
    u.first_name,
    u.last_name,
    u.email,
    u.password,
    u.phone,
    u.avatar,
    u.role,
    u.is_block,
    u.cart_id,
    a.address_id,
    a.province,
    a.district,
    a.commune,
    a.address_detail,
    a.is_default
  FROM user u
    LEFT JOIN address a
      ON u.user_id = a.user_id
      AND a.is_default = 1
  WHERE u.user_id = $UserId;
END
$$

DELIMITER ;

--
-- Create table `product_category`
--
CREATE TABLE product_category (
  product_category_id char(36) NOT NULL COMMENT 'Định danh thông tin giap tiếp danh mục sản phẩm và sản phẩm',
  product_id char(36) NOT NULL COMMENT 'Đinh danh sản phẩm',
  category_id char(36) NOT NULL COMMENT 'Định danh danh mục sản phẩm',
  PRIMARY KEY (product_category_id)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 16384,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_unicode_ci,
COMMENT = 'Bảng thông tin giao tiếp danh mục sản phẩm và sản phẩm';

DELIMITER $$

--
-- Create procedure `Proc_ConvertStringToTable`
--
CREATE DEFINER = 'root'@'%'
PROCEDURE Proc_ConvertStringToTable (IN $lstValue text, IN $SeparateCharacter char(1))
BEGIN
  DECLARE $strJson longtext;
  SET $strJson = CONCAT('[{"a":"', REPLACE($lstValue, $SeparateCharacter, '"},{"a":"'), '"}]');
  DROP TEMPORARY TABLE IF EXISTS tmpListConvert;
  CREATE TEMPORARY TABLE tmpListConvert (
    value varchar(500)
  ) COLLATE utf8mb4_unicode_ci;

  IF JSON_VALID($strJson) = 1 THEN
    INSERT INTO tmpListConvert
      SELECT
        *
      FROM JSON_TABLE ($strJson, "$[*]"
      COLUMNS (
      a varchar(500) PATH "$.a"
      )
      ) AS tt;
  END IF;
END
$$

DELIMITER ;

--
-- Create table `order`
--
CREATE TABLE `order` (
  order_id char(36) NOT NULL COMMENT 'Định danh thông tin đơn hàng',
  user_id char(36) NOT NULL COMMENT 'Định danh của người dùng',
  total_amount decimal(10, 0) NOT NULL COMMENT 'Tổng số tiền của đơn hàng',
  status int NOT NULL COMMENT 'Trạng thái của đươn hàng (0: chờ lấy hàng, 1: đang giao, 2: giao thành công, 3: đã hủy đơn, 4: giao hàng thất bại)',
  user_name varchar(255) NOT NULL COMMENT 'Tên người nhận hàng',
  created_date datetime NOT NULL COMMENT 'Ngày tạo đơn hàng',
  cancel_date datetime DEFAULT NULL COMMENT 'Ngày hủy đơn hàng',
  delivery_date datetime DEFAULT NULL COMMENT 'Ngày giao hàng',
  succes_date datetime DEFAULT NULL COMMENT 'Ngày giao hàng thành công',
  phone int NOT NULL COMMENT 'Số điện thoại nhận hàng',
  address varchar(255) NOT NULL COMMENT 'Địa chỉ nhận hàng',
  voucher_amount decimal(10, 0) DEFAULT NULL COMMENT 'Giá tiền được  giảm sau khi áp dụng mã giảm giá',
  product_amount decimal(10, 0) NOT NULL COMMENT 'Tổng số tiền của sản phẩm',
  PRIMARY KEY (order_id)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 16384,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_unicode_ci,
COMMENT = 'Bảng thông tin đơn hàng';

--
-- Create table `product_order`
--
CREATE TABLE product_order (
  product_order_id char(36) NOT NULL,
  order_id char(36) NOT NULL COMMENT 'Định danh đơn hàng',
  product_id char(36) NOT NULL COMMENT 'Định danh loại sản phẩm',
  product_detail_id char(36) NOT NULL COMMENT 'Đinh danh sản phẩm',
  product_amount decimal(10, 0) DEFAULT NULL,
  product_name varchar(255) DEFAULT NULL,
  color_name varchar(100) DEFAULT NULL,
  size_name varchar(100) DEFAULT NULL,
  url_img varchar(255) DEFAULT NULL,
  quantity int NOT NULL DEFAULT 1 COMMENT 'Số lượng sp',
  PRIMARY KEY (product_order_id)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 8192,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_unicode_ci,
COMMENT = 'Định danh thông tin giao tiếp sản phẩm và đơn hàng';

--
-- Create table `product`
--
CREATE TABLE product (
  product_id char(36) NOT NULL COMMENT 'Định danh của sản phẩm',
  product_code varchar(255) DEFAULT NULL COMMENT 'Mã sản phẩm',
  product_name varchar(255) NOT NULL COMMENT 'Tên sản phẩm',
  summary varchar(255) DEFAULT NULL COMMENT 'Tổng quan về sản phẩm',
  description varchar(255) DEFAULT NULL COMMENT 'Mô tả chi tiết về sản phẩm',
  created_date datetime NOT NULL COMMENT 'Ngày tạo sản phẩm',
  status int NOT NULL COMMENT 'Trạng thái của sản phẩm (Đang bán/ Ngừng bán)',
  outstanding int NOT NULL DEFAULT 0 COMMENT 'Mức độ nổi bật: 1 --> 10',
  PRIMARY KEY (product_id)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 8192,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_unicode_ci,
COMMENT = 'Bảng thông tin sản phẩm';

--
-- Create table `product_detail`
--
CREATE TABLE product_detail (
  product_detail_id char(36) NOT NULL COMMENT 'Định danh thông tin chi tiết sản phẩm',
  product_id char(36) NOT NULL COMMENT 'Định danh của sản phẩm',
  img_url varchar(255) DEFAULT NULL COMMENT 'Đường dẫn ảnh sản phẩm',
  sale_price decimal(10, 0) NOT NULL COMMENT 'Giá bán của sản phẩm',
  purchase_price decimal(10, 0) NOT NULL COMMENT 'Giá nhập của sản phẩm',
  size_name varchar(100) DEFAULT NULL COMMENT 'Kích cỡ của sản phẩm',
  color_name varchar(255) DEFAULT NULL COMMENT 'Màu sắc của sản phẩm',
  quantity int NOT NULL COMMENT 'Số lượng hiện tại của sản phẩm',
  created_date datetime DEFAULT NULL,
  product_discount decimal(10, 2) DEFAULT NULL COMMENT 'Giảm giá bao nhiêu %',
  sale_price_old decimal(10, 0) DEFAULT NULL COMMENT 'Giá cũ',
  PRIMARY KEY (product_detail_id)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 2730,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_unicode_ci,
COMMENT = 'Bảng thông tin chi tiết sản phẩm';

DELIMITER $$

--
-- Create procedure `Proc_ProductInfo`
--
CREATE DEFINER = 'root'@'%'
PROCEDURE Proc_ProductInfo (IN $productId char(36))
COMMENT 'Lấy thông tin về sản phẩm để hiển thị trên trang bán hàng'
BEGIN
  DROP TEMPORARY TABLE IF EXISTS result1;
  CREATE TEMPORARY TABLE result1 COLLATE utf8mb4_unicode_ci
  SELECT
    pd.product_id,
    COUNT(pd.product_detail_id) AS count_detail, -- số sản phẩm trong 1 loại sp
    GROUP_CONCAT(IFNULL(pd.img_url, '') SEPARATOR ';') AS img_url,
    MAX(pd.sale_price) AS sale_price_max,
    MIN(pd.sale_price) AS sale_price_min,
    MAX(pd.sale_price_old) AS sale_price_old,
    MAX(pd.product_discount) AS product_discount,
    p.product_code,
    p.product_name,
    p.description,
    p.created_date,
    p.outstanding,
    GROUP_CONCAT(IFNULL(pd.color_name, '') SEPARATOR ';') AS colors,
    GROUP_CONCAT(IFNULL(pd.size_name, '') SEPARATOR ';') AS sizes,
    SUM(IFNULL(pd.quantity, 0)) AS total_quantity -- Lấy tổng số sp của loại sp
  FROM product_detail pd
    LEFT JOIN product p
      ON pd.product_id = p.product_id
  WHERE p.product_id = $productId
  GROUP BY pd.product_id,
           p.product_code,
           p.product_name,
           p.description,
           p.created_date,
           p.outstanding;

  -- Lấy số sao đánh giá của sp
  DROP TEMPORARY TABLE IF EXISTS result2;
  CREATE TEMPORARY TABLE result2 COLLATE utf8mb4_unicode_ci (SELECT
      r1.*,
      AVG(IFNULL(c.rate, 0)) AS rate, -- trung bình cộng số sao đánh giá
      COUNT(DISTINCT c.comment_id) AS count_comment
    FROM result1 r1
      LEFT JOIN comment c
        ON r1.product_id = c.product_id
    GROUP BY r1.product_id,
             r1.product_code,
             r1.product_name,
             r1.description,
             r1.created_date,
             r1.product_discount,
             r1.sale_price_old,
             r1.sale_price_min,
             r1.sale_price_max,
             r1.img_url,
             r1.outstanding,
             r1.count_detail,
             r1.colors,
             r1.sizes,
             r1.total_quantity);

  -- Lấy số sp đã bán của sp
  DROP TEMPORARY TABLE IF EXISTS result3;
  CREATE TEMPORARY TABLE result3 COLLATE utf8mb4_unicode_ci
  SELECT
    r2.*,
    CASE WHEN o.status <> 4 THEN SUM(IFNULL(po.quantity, 0)) ELSE 0 END AS count_order -- Số sp đã bán: khác 4(khác đã hủy đơn)
  FROM result2 r2
    LEFT JOIN product_order po
      ON r2.product_id = po.product_id
    LEFT JOIN `order` o
      ON po.order_id = o.order_id
  GROUP BY r2.product_id,
           r2.product_code,
           r2.product_name,
           r2.description,
           r2.created_date,
           r2.product_discount,
           r2.sale_price_old,
           r2.sale_price_min,
           r2.sale_price_max,
           r2.img_url,
           r2.outstanding,
           r2.count_detail,
           r2.rate,
           o.status,
           r2.colors,
           r2.sizes,
           r2.count_comment,
           r2.total_quantity
  ;
  SELECT
    *
  FROM result3 r
  ;
END
$$

--
-- Create procedure `Proc_GetProductHome`
--
CREATE DEFINER = 'root'@'%'
PROCEDURE Proc_GetProductHome (IN $keyword varchar(255),
IN $rating int,
IN $fromAmount decimal,
IN $toAmount decimal,
IN $category text,
IN $sort int, -- sắp xếp:  1: Mới nhất, 2: Báy chạy, 3: Giá Thấp đến cao, 4: Giá Cao đến thấp
IN $page int,
IN $pageSize int)
COMMENT 'Lấy danh sách sản phẩm trang home page có tìm kiếm, sắp xếp,...'
BEGIN
  DECLARE $totalRecord int;
  DECLARE $offset int;
  SET $offset = $page * $pageSize;

  DROP TEMPORARY TABLE IF EXISTS result1;
  CREATE TEMPORARY TABLE result1 COLLATE utf8mb4_unicode_ci
  SELECT
    pd.product_id,
    COUNT(pd.product_detail_id) AS count_detail, -- số sản phẩm trong 1 loại sp
    GROUP_CONCAT(IFNULL(pd.img_url, '') SEPARATOR ';') AS img_url,
    MAX(pd.sale_price) AS sale_price_max,
    MIN(pd.sale_price) AS sale_price_min,
    MAX(pd.sale_price_old) AS sale_price_old,
    MAX(pd.product_discount) AS product_discount,
    p.product_code,
    p.product_name,
    p.description,
    p.created_date,
    p.outstanding
  FROM product_detail pd
    LEFT JOIN product p
      ON pd.product_id = p.product_id
  GROUP BY pd.product_id,
           p.product_code,
           p.product_name,
           p.description,
           p.created_date,
           p.outstanding
  ;

  -- Lấy số sp đã bán của sp
  DROP TEMPORARY TABLE IF EXISTS result2;
  CREATE TEMPORARY TABLE result2 COLLATE utf8mb4_unicode_ci (SELECT
      r1.*,
      AVG(IFNULL(c.rate, 0)) AS rate -- trung bình cộng số sao đánh giá
    FROM result1 r1
      LEFT JOIN comment c
        ON r1.product_id = c.product_id
    GROUP BY r1.product_id,
             r1.product_code,
             r1.product_name,
             r1.description,
             r1.created_date,
             r1.product_discount,
             r1.sale_price_old,
             r1.sale_price_min,
             r1.sale_price_max,
             r1.img_url,
             r1.outstanding,
             r1.count_detail);

  -- Lấy số sao đánh giá của sp
  DROP TEMPORARY TABLE IF EXISTS result3;
  CREATE TEMPORARY TABLE result3 COLLATE utf8mb4_unicode_ci
  SELECT
    r2.*,
    CASE WHEN o.status <> 4 THEN SUM(IFNULL(po.quantity, 0)) ELSE 0 END AS count_order -- Số sp đã bán: khác 4(khác đã hủy đơn)
  FROM result2 r2
    LEFT JOIN product_order po
      ON r2.product_id = po.product_id
    LEFT JOIN `order` o
      ON po.order_id = o.order_id
  GROUP BY r2.product_id,
           r2.product_code,
           r2.product_name,
           r2.description,
           r2.created_date,
           r2.product_discount,
           r2.sale_price_old,
           r2.sale_price_min,
           r2.sale_price_max,
           r2.img_url,
           r2.outstanding,
           r2.count_detail,
           r2.rate,
           o.status
  ;
  -- Lấy danh sách sp theo nhóm Danh mục
  IF $category IS NOT NULL
    AND $category <> '' THEN
    CALL Proc_ConvertStringToTable($category, ',');
    DROP TEMPORARY TABLE IF EXISTS tmpProductCategory;
    CREATE TEMPORARY TABLE tmpProductCategory
    SELECT
      pc.category_id,
      pc.product_id
    FROM product_category pc
      INNER JOIN tmpListConvert tlc
        ON pc.category_id = tlc.value;

    -- Lấy tổng số bản ghi
    SELECT
      COUNT(*) INTO $totalRecord
    FROM result3 r
      INNER JOIN tmpProductCategory tdc
        ON r.product_id = tdc.product_id
    WHERE r.product_name LIKE CONCAT('%', IFNULL($keyword, ''), '%')
    AND ($fromAmount IS NULL
    OR r.sale_price_max >= $fromAmount)
    AND ($toAmount IS NULL
    OR r.sale_price_min <= $toAmount);
    -- Lấy danh sách sản phẩm
    SELECT
      *,
      $totalRecord AS totalRecord
    FROM result3 r
      INNER JOIN tmpProductCategory tdc
        ON r.product_id = tdc.product_id
    WHERE r.product_name LIKE CONCAT('%', IFNULL($keyword, ''), '%')
    AND ($fromAmount IS NULL
    OR r.sale_price_max >= $fromAmount)
    AND ($toAmount IS NULL
    OR r.sale_price_min <= $toAmount)
    ORDER BY (CASE WHEN $sort = 1 THEN created_date WHEN $sort = 2 THEN count_order WHEN $sort = 4 THEN sale_price_max END) DESC,
    (CASE WHEN $sort = 3 THEN sale_price_min END) ASC,
    r.outstanding DESC
    LIMIT $pageSize OFFSET $offset
    ;

  ELSE
    -- Lấy tổng số bản ghi
    SELECT
      COUNT(*) INTO $totalRecord
    FROM result3 r
    WHERE r.product_name LIKE CONCAT('%', IFNULL($keyword, ''), '%')
    AND ($fromAmount IS NULL
    OR r.sale_price_max >= $fromAmount)
    AND ($toAmount IS NULL
    OR r.sale_price_min <= $toAmount);
    -- Lấy danh sách sản phẩm
    SELECT
      *,
      $totalRecord AS totalRecord
    FROM result3 r
    WHERE r.product_name LIKE CONCAT('%', IFNULL($keyword, ''), '%')
    AND ($fromAmount IS NULL
    OR r.sale_price_max >= $fromAmount)
    AND ($toAmount IS NULL
    OR r.sale_price_min <= $toAmount)
    ORDER BY (CASE WHEN $sort = 1 THEN created_date WHEN $sort = 2 THEN count_order WHEN $sort = 4 THEN sale_price_max END) DESC,
    (CASE WHEN $sort = 3 THEN sale_price_min END) ASC,
    r.outstanding DESC
    LIMIT $pageSize OFFSET $offset
    ;
  END IF;


END
$$

--
-- Create function `SnakeToPascal`
--
CREATE DEFINER = 'root'@'%'
FUNCTION SnakeToPascal (str varchar(200))
RETURNS varchar(200) CHARSET utf8mb4
NO SQL
BEGIN
  DECLARE n,
          pos int DEFAULT 1;
  DECLARE sub,
          proper varchar(128) DEFAULT '';

  IF LENGTH(TRIM(str)) > 0 THEN
    WHILE pos > 0 DO
      SET pos = LOCATE('_', TRIM(str), n);
      IF pos = 0 THEN
        SET sub = LOWER(TRIM(SUBSTR(TRIM(str), n)));
      ELSE
        SET sub = LOWER(TRIM(SUBSTR(TRIM(str), n, pos - n)));
      END IF;

      SET proper = CONCAT_WS('', proper, CONCAT(UPPER(LEFT(sub, 1)), SUBSTR(sub, 2)));
      SET n = pos + 1;
    END WHILE;
  END IF;

  RETURN TRIM(proper);
END
$$

--
-- Create procedure `Proc_GenEntity`
--
CREATE DEFINER = 'root'@'%'
PROCEDURE Proc_GenEntity (IN tableName varchar(150))
COMMENT 'Tạo Entity'
BEGIN
  SELECT
    field
  FROM (SELECT
      CONCAT('public ',
      CASE WHEN
          DATA_TYPE = 'char' AND
          CHARACTER_MAXIMUM_LENGTH = 36 THEN 'Guid' WHEN DATA_TYPE = 'bit' THEN 'bool' WHEN
          DATA_TYPE = 'int' THEN 'int' WHEN DATA_TYPE = 'bidgint' THEN 'long' WHEN
          DATA_TYPE = 'tinyint' THEN 'int' WHEN DATA_TYPE = 'double' THEN 'decimal' WHEN
          DATA_TYPE = 'decimal' THEN 'decimal' WHEN DATA_TYPE = 'float' THEN 'decimal' WHEN
          DATA_TYPE = 'date' THEN 'DateTime' WHEN DATA_TYPE = 'datetime' THEN 'DateTime' WHEN
          DATA_TYPE = 'timestamp' THEN 'DateTime' ELSE 'string' END,
      ' ',
      CASE IS_NULLABLE WHEN 'YES' THEN '?' ELSE '' END,
      ' ',
      column_name,
      ' {get;set;}') AS field,
      100 AS gp,
      ordinal_position AS so
    FROM information_schema.COLUMNS
    WHERE TABLE_NAME = tableName
    AND TABLE_SCHEMA = 'develop'
    UNION ALL
    SELECT
      '/// <summary>',
      10,
      ordinal_position
    FROM information_schema.COLUMNS
    WHERE TABLE_NAME = tableName
    AND TABLE_SCHEMA = 'develop'
    UNION ALL
    SELECT
      CONCAT('/// ',
      CASE WHEN
          column_key = 'PRI' AND
          (column_comment IS NULL OR
          column_comment = '') THEN 'PK' ELSE column_comment END),
      20,
      ordinal_position
    FROM information_schema.COLUMNS
    WHERE TABLE_NAME = tableName
    AND TABLE_SCHEMA = 'develop'
    UNION ALL
    SELECT
      '/// <summary>',
      30,
      ordinal_position
    FROM information_schema.COLUMNS
    WHERE TABLE_NAME = tableName
    AND TABLE_SCHEMA = 'develop'
    UNION ALL
    SELECT
      '[Key]',
      40,
      ordinal_position
    FROM information_schema.COLUMNS
    WHERE TABLE_NAME = tableName
    AND column_key = 'PRI'
    AND TABLE_SCHEMA = 'develop'
    UNION ALL
    SELECT
      '/// <summary>',
      -30,
      0
    UNION ALL
    SELECT
      CONCAT('/// ', table_comment),
      -29,
      0
    FROM information_schema.tables
    WHERE TABLE_NAME = tableName
    AND TABLE_SCHEMA = 'develop'
    UNION ALL
    SELECT
      '/// <summary>',
      -28,
      0
    UNION ALL
    SELECT
      CONCAT('[Table("', LOWER(tableName), '")]'),
      -10,
      0
    UNION ALL
    SELECT
      CONCAT('public class ', SnakeToPascal(tableName), 'Entity'),
      -9,
      0
    UNION ALL
    SELECT
      '{',
      -8,
      0
    UNION ALL
    SELECT
      '}',
      1000,
      1000) AS T
  ORDER BY so, gp;

END
$$

DELIMITER ;

--
-- Create table `voucher_user`
--
CREATE TABLE voucher_user (
  voucher_user_id char(36) NOT NULL COMMENT 'Định danh thông tin giao tiếp người dùng và mã giảm giá',
  voucher_id char(36) NOT NULL COMMENT 'Định danh của mã giảm giá',
  user_id char(36) NOT NULL COMMENT 'Định danh của người dùng',
  PRIMARY KEY (voucher_user_id)
)
ENGINE = INNODB,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_unicode_ci,
COMMENT = 'Bảng thông tin giao tiếp người dùng và mã giảm giá';

--
-- Create table `voucher`
--
CREATE TABLE voucher (
  vocher_id char(36) NOT NULL COMMENT 'Định danh của mã giảm giá',
  voucher_code varchar(50) DEFAULT NULL COMMENT 'Tên mã giảm giá',
  description varchar(255) DEFAULT NULL COMMENT 'Thông tin mô tả chi tiết về mã giảm giá',
  discount decimal(10, 0) DEFAULT NULL COMMENT 'Số phần trăm giảm giá',
  max_amount decimal(10, 0) DEFAULT NULL COMMENT 'Số tiền tối đa được giảm sau khi áp dụng mã giảm giá',
  order_min_amount decimal(10, 0) DEFAULT NULL COMMENT 'Số tiền tối thiểu của đơn hàng để được áp dụng mã giảm giá',
  PRIMARY KEY (vocher_id)
)
ENGINE = INNODB,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_unicode_ci,
COMMENT = 'Bảng thông tin mã giảm giá';

--
-- Create table `size`
--
CREATE TABLE size (
  size_id char(36) NOT NULL COMMENT 'Định danh kích cỡ',
  size_name varchar(100) NOT NULL COMMENT 'Tên kích cỡ',
  status int NOT NULL DEFAULT 0 COMMENT 'Trạng thái: 0 - không sử dụng, 1 - đang sử dụng',
  PRIMARY KEY (size_id)
)
ENGINE = INNODB,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_unicode_ci,
COMMENT = 'Bảng thông tin kích cỡ';

--
-- Create table `setting`
--
CREATE TABLE setting (
  logo varchar(255) NOT NULL COMMENT 'Logo của website',
  backgroud varchar(255) DEFAULT NULL COMMENT 'Hình nên giới thiệu',
  template varchar(255) NOT NULL COMMENT 'Giao diện, thiết kế Website'
)
ENGINE = INNODB,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_unicode_ci,
COMMENT = 'Bảng cấu hình trang bán hàng';

--
-- Create table `product_cart`
--
CREATE TABLE product_cart (
  product_cart_id char(36) NOT NULL COMMENT 'Định danh thông tin giao tiếp sản phẩm và giỏ hàng',
  cart_id char(36) NOT NULL COMMENT 'Định danh giỏ hàng',
  product_detail_id char(36) NOT NULL COMMENT 'Định danh của chi tiết sản phẩm',
  quantity int NOT NULL COMMENT 'Số lượng sản phẩm',
  PRIMARY KEY (product_cart_id)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 16384,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_unicode_ci,
COMMENT = 'Bảng thông tin giao tiếp sản phẩm và giỏ hàng';

--
-- Create table `comment`
--
CREATE TABLE comment (
  comment_id char(36) NOT NULL COMMENT 'Định danh của đánh giá, bình luận',
  user_id char(36) NOT NULL COMMENT 'Định danh của người đánh giá',
  product_id char(36) NOT NULL COMMENT 'Định danh sản phẩm',
  rate int NOT NULL COMMENT 'Số sao đánh giá cho sản phẩm',
  content varchar(255) DEFAULT NULL COMMENT 'Nội dung bình luận',
  created_date datetime NOT NULL COMMENT 'Ngày tạo đánh giá, bình luận',
  img_url varchar(255) DEFAULT NULL COMMENT 'Ảnh bình luận, đánh giá',
  PRIMARY KEY (comment_id)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 4096,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_unicode_ci,
COMMENT = 'Bảng đánh giá, bình luận';

--
-- Create table `color`
--
CREATE TABLE color (
  color_id char(36) NOT NULL COMMENT 'Định danh màu',
  color_name varchar(100) NOT NULL COMMENT 'Tên màu',
  status int NOT NULL DEFAULT 0 COMMENT 'Trạng thái: 0 - không sử dụng, 1 - đang sử dụng',
  PRIMARY KEY (color_id)
)
ENGINE = INNODB,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_unicode_ci,
COMMENT = 'Bảng thông tin màu sắc';

--
-- Create table `category`
--
CREATE TABLE category (
  category_id char(36) NOT NULL COMMENT 'Định danh của danh mục sản phẩm',
  category_name varchar(255) NOT NULL COMMENT 'Tên danh mục sản phẩm',
  created_date datetime NOT NULL COMMENT 'Tên danh mục sản phẩm',
  PRIMARY KEY (category_id)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 8192,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_unicode_ci,
COMMENT = 'Bảng thông tin danh mục sản phẩm';

--
-- Create table `attribute`
--
CREATE TABLE attribute (
  attribute_id char(36) NOT NULL COMMENT 'Đanh danh bảng thông tin thuộc tính sản phẩm',
  product_id char(36) NOT NULL COMMENT 'Định danh của sản phẩm',
  attribute_title varchar(255) NOT NULL COMMENT 'Tiêu đề thuộc tính',
  attribute_value varchar(255) NOT NULL COMMENT 'Giá trị thuộc tính',
  sort_order int NOT NULL COMMENT 'Số thứ tự',
  PRIMARY KEY (attribute_id)
)
ENGINE = INNODB,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_unicode_ci,
COMMENT = 'Bảng thông tin các thuộc tính của sản phẩm';

-- 
-- Dumping data for table user
--
INSERT INTO user VALUES
('18d24230-a23f-4eb4-81b7-01c0bd4f0ab7', 'dsd', 'dsd', 'dasdsd@gmail.com', '00000000@Abc', '868389654', NULL, 1, 0, '00000000-0000-0000-0000-000000000000'),
('271fe070-57ab-4cff-9d6e-3c28b1acc4db', 'Đinh Quang', 'Đạt', 'dat21051999@gmail.com', '12345678@Abc', '868389675', NULL, 1, 0, '00000000-0000-0000-0000-000000000000'),
('a566d829-81e2-4948-ac3a-f938ce2e97cb', 'q', 'q', '1234688@gmail.com', '12345678@Abc', '868389657', NULL, 1, 0, '00000000-0000-0000-0000-000000000000'),
('b26bc655-17cd-46a8-877a-129525abd0cf', 's', 's', '54848948@gmail.com', '12345678@Abc', '868389678', NULL, 1, 0, '00000000-0000-0000-0000-000000000000'),
('b4fe01f5-59a7-11ed-90ec-0242ac130002', 'Đinh Quang', 'Đạt', 'dat123456@gmail.com', '$2a$11$wR53Bf1H0O69ZAv8fmMsgOv3jxb2Ib6dcarmzcC473aIBwohHfn46', '0868389674', '', 0, 0, 'b4fe0249-59a7-11ed-90ec-0242ac130002');

-- 
-- Dumping data for table voucher_user
--
-- Table develop.voucher_user does not contain any data (it is empty)

-- 
-- Dumping data for table voucher
--
-- Table develop.voucher does not contain any data (it is empty)

-- 
-- Dumping data for table size
--
-- Table develop.size does not contain any data (it is empty)

-- 
-- Dumping data for table setting
--
-- Table develop.setting does not contain any data (it is empty)

-- 
-- Dumping data for table product_order
--
INSERT INTO product_order VALUES
('f99ff3a2-68e4-11ed-90ec-0242ac130002', '80786fe0-68e4-11ed-90ec-0242ac130002', 'f8f5e467-68cf-11ed-90ec-0242ac130002', '40f45b00-68d0-11ed-90ec-0242ac130002', 0, '', '', '', '', 10),
('f99ff601-68e4-11ed-90ec-0242ac130002', '80786fe0-68e4-11ed-90ec-0242ac130002', 'f8f5e467-68cf-11ed-90ec-0242ac130002', '40f44fcf-68d0-11ed-90ec-0242ac130002', 0, '', '', '', '', 5);

-- 
-- Dumping data for table product_detail
--
INSERT INTO product_detail VALUES
('3a3abc4a-68bf-11ed-90ec-0242ac130002', 'd9f7bf0c-68b8-11ed-90ec-0242ac130002', '', 170000, 80000, 'L', 'Vàng', 100, '2022-11-20 10:36:44', 0.00, 200000),
('3a3abecd-68bf-11ed-90ec-0242ac130002', 'd9f7bf0c-68b8-11ed-90ec-0242ac130002', 'https://i.picsum.photos/id/533/200/300.jpg?grayscale&hmac=_2lwSEjZUA8YvGvJ90l-Ewf3XnJd7TBMRNdKaediHzU', 160000, 80000, 'M', 'Vàng', 90, '2022-11-20 10:36:44', 12.00, 250000),
('3a3abece-68bf-11ed-90ec-0242ac130002', 'd9f7bf0c-68b8-11ed-90ec-0242ac130002', 'https://i.picsum.photos/id/533/200/300.jpg?grayscale&hmac=_2lwSEjZUA8YvGvJ90l-Ewf3XnJd7TBMRNdKaediHzU', 180000, 80000, 'M', 'Đỏ', 100, '2022-11-20 10:36:44', 0.00, NULL),
('3a3abf5c-68bf-11ed-90ec-0242ac130002', 'd9f7bf0c-68b8-11ed-90ec-0242ac130002', 'https://i.picsum.photos/id/533/200/300.jpg?grayscale&hmac=_2lwSEjZUA8YvGvJ90l-Ewf3XnJd7TBMRNdKaediHzU', 150000, 80000, 'L', 'Đỏ', 100, '2022-11-20 10:36:44', 0.00, 300000),
('40f44cc5-68d0-11ed-90ec-0242ac130002', 'f8f5e467-68cf-11ed-90ec-0242ac130002', 'https://i.picsum.photos/id/533/200/300.jpg?grayscale&hmac=_2lwSEjZUA8YvGvJ90l-Ewf3XnJd7TBMRNdKaediHzU', 270000, 130000, 'M', 'Xanh', 100, '2022-11-20 12:38:37', 15.00, 450000),
('40f44cc6-68d0-11ed-90ec-0242ac130002', 'f8f5e467-68cf-11ed-90ec-0242ac130002', 'https://i.picsum.photos/id/533/200/300.jpg?grayscale&hmac=_2lwSEjZUA8YvGvJ90l-Ewf3XnJd7TBMRNdKaediHzU', 260000, 130000, 'L', 'Đen', 50, '2022-11-20 12:38:37', 20.00, 400000),
('40f44fcf-68d0-11ed-90ec-0242ac130002', 'f8f5e467-68cf-11ed-90ec-0242ac130002', 'https://i.picsum.photos/id/533/200/300.jpg?grayscale&hmac=_2lwSEjZUA8YvGvJ90l-Ewf3XnJd7TBMRNdKaediHzU', 280000, 130000, 'M', 'Đen', 100, '2022-11-20 12:38:37', 10.00, 450000),
('40f45b00-68d0-11ed-90ec-0242ac130002', 'f8f5e467-68cf-11ed-90ec-0242ac130002', 'https://i.picsum.photos/id/533/200/300.jpg?grayscale&hmac=_2lwSEjZUA8YvGvJ90l-Ewf3XnJd7TBMRNdKaediHzU', 250000, 130000, 'L', 'Xanh', 100, '2022-11-20 12:38:37', 35.00, 450000);

-- 
-- Dumping data for table product_category
--
INSERT INTO product_category VALUES
('d18b4edc-69b0-11ed-90ec-0242ac130002', 'd9f7bf0c-68b8-11ed-90ec-0242ac130002', 'bfa15ef1-69b0-11ed-90ec-0242ac130002');

-- 
-- Dumping data for table product_cart
--
INSERT INTO product_cart VALUES
('e5a4931a-9855-4fb0-8f67-6b4428a267fc', 'b4fe0249-59a7-11ed-90ec-0242ac130002', '', 0);

-- 
-- Dumping data for table product
--
INSERT INTO product VALUES
('d9f7bf0c-68b8-11ed-90ec-0242ac130002', 'AO0001', 'Áo khoác gió', '', '', '2022-11-20 09:51:26', 1, 6),
('f8f5e467-68cf-11ed-90ec-0242ac130002', 'QU0001', 'Quần jean', '', '', '2022-11-20 12:38:36', 1, 4);

-- 
-- Dumping data for table `order`
--
INSERT INTO `order` VALUES
('36360829-d21a-453e-99a5-9ef90d46c6e6', 'b4fe01f5-59a7-11ed-90ec-0242ac130002', 12312, 4, 'Đạt', '2022-08-07 14:29:21', NULL, '2022-11-09 14:26:41', '2022-11-07 14:26:46', 1241244, '1244124', 1244124, 123123132),
('80786fe0-68e4-11ed-90ec-0242ac130002', '', 0, 0, '', '2022-11-20 15:06:56', '2022-11-20 15:06:56', '2022-11-20 15:06:56', '2022-11-20 15:06:56', 0, '', 0, 0);

-- 
-- Dumping data for table comment
--
INSERT INTO comment VALUES
('090fe622-68e7-11ed-90ec-0242ac130002', '', 'f8f5e467-68cf-11ed-90ec-0242ac130002', 1, '', '2022-11-20 15:21:41', ''),
('090fe875-68e7-11ed-90ec-0242ac130002', '', 'f8f5e467-68cf-11ed-90ec-0242ac130002', 5, '', '2022-11-20 15:21:41', ''),
('3e3e34d0-68e8-11ed-90ec-0242ac130002', '', 'f8f5e467-68cf-11ed-90ec-0242ac130002', 3, '', '2022-11-20 15:30:20', ''),
('3e3e374d-68e8-11ed-90ec-0242ac130002', '', 'f8f5e467-68cf-11ed-90ec-0242ac130002', 4, '', '2022-11-20 15:30:20', '');

-- 
-- Dumping data for table color
--
-- Table develop.color does not contain any data (it is empty)

-- 
-- Dumping data for table category
--
INSERT INTO category VALUES
('70575b69-69b0-11ed-90ec-0242ac130002', 'Quần áo thu đông', '2022-11-21 15:23:52'),
('bfa15ef1-69b0-11ed-90ec-0242ac130002', 'Thời trang giới trẻ', '2022-11-21 15:25:55');

-- 
-- Dumping data for table attribute
--
-- Table develop.attribute does not contain any data (it is empty)

-- 
-- Dumping data for table address
--
INSERT INTO address VALUES
('0ae0e959-5b2f-492d-9974-499cc8665b73', 'a566d829-81e2-4948-ac3a-f938ce2e97cb', 'Tỉnh Cao Bằng', 4, 'Huyện Bảo Lạc', 43, 'Xã Thượng Hà', 1327, 'GN', 1),
('29074a39-59a8-11ed-90ec-0242ac130002', 'b4fe01f5-59a7-11ed-90ec-0242ac130002', 'Bắc Giang', NULL, 'Hiệp hòa', NULL, 'Mai Đình', NULL, 'thôn Giáp Ngũ', 1),
('543a7b31-54f8-4b01-b868-eb682b2f4770', 'b26bc655-17cd-46a8-877a-129525abd0cf', 'Tỉnh Cao Bằng', 4, 'Huyện Bảo Lâm', 42, 'Xã Lý Bôn', 1294, 'jk', 1),
('6c5b9a81-9f66-4ea0-9bf6-95cb8d2bd361', '18d24230-a23f-4eb4-81b7-01c0bd4f0ab7', 'Tỉnh Cao Bằng', 4, 'Huyện Bảo Lâm', 42, 'Xã Đức Hạnh', 1291, '12', 1),
('acb23023-36b1-4b67-8187-83d792e320e8', 'b4fe01f5-59a7-11ed-90ec-0242ac130002', 'test', NULL, 'test', NULL, 'test', NULL, 'test1', 0),
('bd2f7a5e-5301-44da-af40-debe5c6e1aa5', 'b4fe01f5-59a7-11ed-90ec-0242ac130002', 'test', NULL, 'test', NULL, 'test', NULL, 'test1', 0),
('c639772a-4d1b-44ab-8680-9be061d8f19a', 'b4fe01f5-59a7-11ed-90ec-0242ac130002', 'test', NULL, 'test', NULL, 'test', NULL, 'test1', 0),
('fa8993ec-906e-4cee-ae56-cc14face7d31', '271fe070-57ab-4cff-9d6e-3c28b1acc4db', 'Tỉnh Cao Bằng', 4, 'Huyện Bảo Lâm', 42, 'Xã Lý Bôn', 1294, '123456', 1);

-- 
-- Restore previous SQL mode
-- 
/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;

-- 
-- Enable foreign keys
-- 
/*!40014 SET FOREIGN_KEY_CHECKS = @OLD_FOREIGN_KEY_CHECKS */;